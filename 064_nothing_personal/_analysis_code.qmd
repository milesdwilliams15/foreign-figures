---
title: "Untitled"
format: html
---

## Setup

```{r packages + settings}
library(tidyverse)
library(socsci)
library(geomtextpath)
library(ggrepel)
library(coolorrr)
library(here)
set_palette(
  qualitative = c(
    "steelblue",
    "navy",
    "red3",
    "orange3"
  ),
  binary = c("navy", "orange"),
  sequential = c("white", "steelblue"),
  diverging = c("red3", "white", "navy")
)
source(here::here("my_theme.R"))
theme_set(my_theme())
saveit <- function(num = 1, ht = 5, wd = 6) {
  ggsave(
    here(
      "064_nothing_personal",
      paste0("fig", num, ".png")
    ),
    height = ht,
    width = wd,
    dpi = 500
  )
}
```

## Data

```{r}
library(vdemdata)

dt <- vdem

dt |>
  transmute(
    country_name,
    year,
    demo = v2x_polyarchy,
    pers = v2xnp_pres,
    auto_bi = ifelse(demo < median(demo, na.rm = T), "Autocracy", "Democracy"),
    pers_bi = ifelse(pers > median(pers, na.rm = T), "Personalist", "Institutional"),
    type = paste0(pers_bi, "\n", auto_bi)
  ) -> dt
```

## Figures

```{r}
dt |>
  drop_na() |>
  group_by(type) |>
  mean_ci(demo)
```

```{r}
#| fig-height: 5
#| fig-width: 6

dt |>
  drop_na() |>
  group_by(type) |>
  mean_ci(demo) |>
  ggplot() +
  aes(
    x = reorder(type, -mean), 
    y = mean
  ) +
  geom_col() +
  labs(
    title = str_wrap(
      "Personalist autocracies have worse overall democracy scores than other regimes",
      width = 37
    ),
    subtitle = str_wrap(
      "Source: Varieties of Democracy {vdemdata} R package",
      width = 55
    ),
    x = "\nRegime Type",
    y = "Quality of Democracy\n(Average)",
    caption = logo
  )
saveit(1)
```

```{r}
#| fig-height: 6
#| fig-width: 6

dt |>
  drop_na() |>
  group_by(type, year) |>
  mean_ci(demo) |>
  ggplot() +
  aes(
    x = year,
    y = mean,
    color = type
  ) +
  geom_point() +
  geom_line() +
  ggpal() +
  guides(
    color = guide_legend(nrow = 2, ncol = 2)
  ) +
  labs(
    title = str_wrap(
      "Personalist autocracies have the worst democracy scores across time",
      width = 37
    ),
    subtitle = str_wrap(
      "Source: Varieties of Democracy {vdemdata} R package",
      width = 55
    ),
    x = NULL,
    y = "Quality of Democracy\n(Average)",
    caption = logo,
    color = "Regime Type"
  )
saveit(2, 6)
```



